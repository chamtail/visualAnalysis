<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>数据流可视化分析平台</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge; charset=utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="数据流可视化分析平台">
    <meta name="author" content="yzs">

    <!-- ionicons -->
    <link rel="shortcut icon" href="/public/images/logo.ico"/>
    <link rel="bookmark" href="/public/images/logo.ico"/>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" type="text/css" href="/public/js/bootstrap/css/bootstrap.min.css">

    <!-- Font Awesome -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- Slider -->
    <link href="/public/css/bootstrap-slider.css" rel="stylesheet"/>

    <!-- Tag Input -->
    <link href="/public/css/jquery.tagsinput.css" rel="stylesheet">

    <!-- Date Time Picker -->
    <!--<link href="/public/css/datetimepicker.css" rel="stylesheet">-->

    <!-- Select2 -->
    <!--<link href="/public/css/select2/select2.css" rel="stylesheet"/>-->

    <!-- Morris -->
    <link href="/public/css/morris.css" rel="stylesheet"/>

    <!-- Datepicker -->
    <link href="/public/css/datepicker.css" rel="stylesheet"/>

    <!-- Animate -->
    <link href="/public/css/animate.min.css" rel="stylesheet">

    <!-- Owl Carousel -->
    <link href="/public/css/owl.carousel.min.css" rel="stylesheet">
    <link href="/public/css/owl.theme.default.min.css" rel="stylesheet">

    <!-- Simplify -->
    <link href="/public/css/simplify.min.css" rel="stylesheet">

    <!-- DataRangePicker -->
    <link href="/public/js/datapicker/daterangepicker.css" rel="stylesheet">

    <!-- MyCss -->
    <link href="/public/css/consultation.css" rel="stylesheet">
    <link href="/public/js/multiple-select/multiple-select.css" rel="stylesheet">

    <!-- labelauty -->
    <link href="/public/js/labelauty/labelauty.css" rel="stylesheet">

    <!-- switch -->
    <link rel="stylesheet" href="/public/js/bootstrap-switch/css/bootstrapSwitch.css">

    <!-- warnKeywords -->
    <link rel="stylesheet" href="/public/css/warnKeywords.css">

    <!-- img box -->
    <link href="/public/css/jquery.lighter.css" type="text/css" rel="stylesheet"/>

    <!-- Jquery -->
    <script src="/public/js/jquery.min.js"></script>

    <!-- MyJs-->
    <script src="/public/js/myJs/myChart.js"></script>

    <!-- Vue -->
    <script src="/public/js/vue.min.js"></script>
</head>
<body class="overflow-hidden">
<div class="wrapper preload">
    <div class="sidebar-right">
        <div class="sidebar-inner scrollable-sidebar" style="overflow: hidden; width: auto; height: 100%;"
             id="apply-right">
            <div class="sidebar-header clearfix">
                <input style="color: #fff" class="form-control dark-input" placeholder="搜索···" type="text"
                       v-model="search" @keyup.13="enter($event)">
            </div>
            <template v-if="fail">
                <div class="title-block" style="color: #e36159; text-align: center">
                    加载失败
                </div>
            </template>
            <template v-else>
                <div class="title-block">
                    会诊申请
                </div>
                <template v-if="normal.length != 0">
                    <div class="content-block">
                        <ul class="sidebar-list">
                            <template v-for="model in normal">
                                <li>
                                    <a :href="'/Chat/index?id='+model.apply_id" class="clearfix">
                                        <img :src="model.doctor_photo != '' ? model.doctor_photo : '/public/images/logo_default.png'"
                                             :title="model.doctor_name" class="img-circle">
                                        <div class="chat-detail m-left-sm">
                                            <div class="chat-name">
                                                <!--<a :href="'/Doctor/info?id='+model.doctor_id">{{model.doctor_name}}</a>-->
                                                {{model.doctor_name}}
                                            </div>
                                            <div class="chat-message">
                                                <!--<a :href="'/Hospital/info?id='+model.hospital_id">{{model.hospital_name}}</a>-->
                                                {{model.hospital_name}}
                                            </div>
                                        </div>
                                        <!--<div class="chat-status">-->
                                        <!--<i class="fa fa-circle-o text-success"></i>-->
                                        <!--</div>-->
                                        <template v-if="model.count != 0">
                                            <div class="chat-alert">
                                                <span class="badge badge-danger bounceIn animation-delay2">{{model.count}}</span>
                                            </div>
                                        </template>
                                    </a>
                                </li>
                            </template>
                        </ul>
                    </div>
                </template>
                <template v-else>
                    <div class="title-block" style="color: #e36159; text-align: center">
                        暂无会话
                    </div>
                </template>

                <div class="title-block">
                    绿色通道
                </div>
                <template v-if="green.length != 0">
                    <div class="content-block">
                        <ul class="sidebar-list">
                            <template v-for="model in green">
                                <li>
                                    <a :href="'/Chat/index?id='+model.apply_id" class="clearfix">
                                        <img :src="model.doctor_photo != '' ? model.doctor_photo : '/public/images/logo_default.png'"
                                             :title="model.doctor_name" class="img-circle">
                                        <div class="chat-detail m-left-sm">
                                            <div class="chat-name">
                                                <!--<a :href="'/Doctor/info?id='+model.doctor_id">{{model.doctor_name}}</a>-->
                                                {{model.doctor_name}}
                                            </div>
                                            <div class="chat-message">
                                                <!--<a :href="'/Hospital/info?id='+model.hospital_id">{{model.hospital_name}}</a>-->
                                                {{model.hospital_name}}
                                            </div>
                                        </div>
                                        <!--<div class="chat-status">-->
                                        <!--<i class="fa fa-circle-o text-success"></i>-->
                                        <!--</div>-->
                                        <template v-if="model.count != 0">
                                            <div class="chat-alert">
                                                <span class="badge badge-danger bounceIn animation-delay2">{{model.count}}</span>
                                            </div>
                                        </template>
                                    </a>
                                </li>
                            </template>
                        </ul>
                    </div>
                </template>
                <template v-else>
                    <div class="title-block" style="color: #e36159; text-align: center">
                        暂无会话
                    </div>
                </template>
            </template>
        </div>
    </div>

    <script>
        var vm_right = new Vue({
            el: '#apply-right',
            data: {
                normal: [],
                green: [],
                search: '',
                params: {},
                fail: true
            },
            mounted: function () {
                $(function () {
                    getChatList();
                })
            },
            methods: {
                enter: function (ev) {
                    if (ev.keyCode == 13) {
                        vm_right.params['search'] = vm_right.search;
                        getChatList();
                    }
                }
            },
        });

        // 获取列表
        function getChatList() {
            $.post('/Chat/getChatList', vm_right.params, function (res) {
                if (res.error_code == 0) {
                    vm_right.fail = false;
                    vm_right.normal = res.normal;
                    vm_right.green = res.green;
                    vm_right.params['search'] = '';
                    var chat_count = 0;

                    for (var i = 0; i < res.normal.length; i++) {
                        chat_count += parseInt(res.normal[i]['count']);
                    }
                    for (var i = 0; i < res.green.length; i++) {
                        chat_count += parseInt(res.green[i]['count']);
                    }
                    if (chat_count != 0) {
                        $('#chat_count').html(chat_count);
                        setTimeout(function () {
                            $('.chat-notification').find('.badge').addClass('active');
                        }, 1000);
                    } else {
                        $('.chat-notification').find('.badge').removeClass('active');
                    }
                } else {
                    vm_right.fail = true;
                }
            });
        }
    </script>

    <header class="top-nav">
        <div class="top-nav-inner">
            <!-- 小屏显示 -->
            <div class="nav-header">
                <button type="button" class="navbar-toggle pull-left sidebar-toggle" id="sidebarToggleSM">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

                <div class="pull-right m-right-sm">
                    <!-- 部署 -->
                    <ul class="nav-notification">
                        <li>
                            <a href="javascript:;" class="logout" title="安全退出">
                                <i class="fa fa-power-off fa-lg"></i>
                            </a>
                        </li>
                    </ul>
                </div>

                <a href="/" class="brand">
                    <i class="fa fa-database"></i><span class="brand-name">数据流可视化分析平台</span>
                </a>
            </div>
            <!-- 小屏显示 -->

            <!-- 大屏显示 -->
            <div class="nav-container">
                <button type="button" class="navbar-toggle pull-left sidebar-toggle" id="sidebarToggleLG">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

                <div class="pull-right m-right-sm">
                    <!-- 部署 -->
                    <ul class="nav-notification">
                        <li>
                            <a href="javascript:;" class="logout" title="安全退出">
                                <i class="fa fa-power-off fa-lg"></i>
                            </a>
                        </li>
                    </ul>
                </div><!-- 大屏显示 -->
            </div>
        </div>
    </header>
    <aside class="sidebar-menu fixed">
        <div class="sidebar-inner scrollable-sidebar">
            <div class="main-menu">
                <ul class="accordion">
                    <li class="menu-header">
                        DashBoard
                    </li>
                    <li class="bg-palette1" id="visual-analysis-input">
                        <a href="#">
                            <span class="menu-content block">
                                <span class="menu-icon"><i class="block fa fa-home fa-lg"></i></span>
                                <span class="text m-left-sm">Input</span>
                            </span>
                            <span class="menu-content-hover block">Input</span>
                        </a>
                    </li>

                    <li class="bg-palette2" id="visual-analysis-apply">
                        <a href="#">
                            <span class="menu-content block">
                                <span class="menu-icon"><i class="fa fa-envelope fa-lg"></i></span>
								<span class="text m-left-sm">Progress</span>
                            </span>
                            <span class="menu-content-hover block">Progress</span>
                        </a>
                    </li>
                    <li class="bg-palette3" id="visual-analysis-channel">
                        <a href="#">
                            <span class="menu-content block">
                                <span class="menu-icon"><i class="fa fa-sign-in fa-lg"></i></span>
								<span class="text m-left-sm">Output</span>
                            </span>
                            <span class="menu-content-hover block">Output</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div><!-- sidebar-inner -->
    </aside>

    <style>
        .index-wel-wrapper {
            width: 350px;
            margin: 200px auto;
        }

        .index-wel {
            width: 100px;
            height: 100px;
            border-radius: 200px;
            border: 1px solid gray;
            float: left;
            font-size: 60px;
            line-height: 100px;
            text-align: center;
        }

        .index-wel-r {
            margin-left: 150px;
        }
    </style>
    <div class="main-container">
        <div class="padding-md">
            <div class="index-wel-wrapper">
                <div class="index-wel index-wel-l">欢</div>
                <div class="index-wel index-wel-r">迎</div>
            </div>
        </div>
    </div>

    <footer class="footer">
    <span class="footer-brand">
        <strong class="text-danger" id="time">正在获取系统时间...</strong>
    </span>
        <p class="no-margin pull-right">
            &copy; 2018 <strong>复旦大学数据流实验室</strong>. ALL Rights Reserved.
        </p>
    </footer>
</div>
</body>
</html>

<!-- Placed at the end of the document so the pages load faster -->

<!-- Bootstrap -->
<script src="/public/js/bootstrap.min.js"></script>

<!-- Flot -->
<script src='/public/js/jquery.flot.min.js'></script>

<!-- Slimscroll -->
<script src='/public/js/jquery.slimscroll.min.js'></script>

<!-- Morris -->
<script src='/public/js/rapheal.min.js'></script>
<script src='/public/js/morris.min.js'></script>

<!-- Datepicker -->
<script src='/public/js/uncompressed/datepicker.js'></script>

<!-- Sparkline -->
<script src='/public/js/sparkline.min.js'></script>

<!-- Skycons -->
<script src='/public/js/uncompressed/skycons.js'></script>

<!-- Popup Overlay -->
<script src='/public/js/jquery.popupoverlay.min.js'></script>

<!-- Easy Pie Chart -->
<script src='/public/js/jquery.easypiechart.min.js'></script>

<!-- Sortable -->
<script src='/public/js/uncompressed/jquery.sortable.js'></script>

<!-- Owl Carousel -->
<script src='/public/js/owl.carousel.min.js'></script>

<!-- Modernizr -->
<script src='/public/js/modernizr.min.js'></script>

<!-- Echarts -->
<script src="/public/js/Echarts/echarts.js"></script>

<!-- Simplify -->
<script src="/public/js/simplify/simplify.js"></script>
<script src="/public/js/simplify/simplify_dashboard.js"></script>

<!-- Moment -->
<script src="/public/js/moment.js"></script>

<!-- labelauty -->
<script src="/public/js/labelauty/labelauty.js"></script>

<!-- img box -->
<script src="/public/js/jquery.lighter.js"></script>
<script>
    var url = "";
    function popWarn(con, href) {
        href = href || '';
        if (href != '') {
            url = href;
        }
        $('#warn-popup h5').html(con);
        $('#warn-popup').popup('show');
    }
    $('.warn-do').on('click', function () {
        $('#warn-popup').popup('hide');
        if (url != '') {
            window.location.href = url;
        }
    });
    $(function () {
        //Delete Widget Confirmation
        $('#confirm-popup').popup({
            vertical: 'top',
            transition: 'all 0.3s'
        });
    });
</script>
<!-- show time -->
<script>
    //去除空格
    String.prototype.Trim = function () {
        return this.replace(/\s+/g, "");
    };

    //去除换行
    function ClearBr(key) {
        key = key.replace(/<\/?.+?>/g, "");
        key = key.replace(/[\r\n]/g, "");
        return key;
    }

    //去除左侧空格
    function LTrim(str) {
        return str.replace(/^\s*/g, "");
    }

    //去右空格
    function RTrim(str) {
        return str.replace(/\s*$/g, "");
    }

    //去掉字符串两端的空格
    function trim(str) {
        return str.replace(/(^\s*)|(\s*$)/g, "");
    }

    //去除字符串中间空格
    function CTim(str) {
        return str.replace(/\s/g, '');
    }

    //是否为由数字组成的字符串
    function is_digitals(str) {
        var reg = /^[0-9]*$/; //匹配整数
        return reg.test(str);
    }

    function startTime() {
        var today = new Date();//定义日期对象
        var yyyy = today.getFullYear();//通过日期对象的getFullYear()方法返回年
        var MM = today.getMonth() + 1;//通过日期对象的getMonth()方法返回月
        var dd = today.getDate();//通过日期对象的getDate()方法返回日
        var hh = today.getHours();//通过日期对象的getHours方法返回小时
        var mm = today.getMinutes();//通过日期对象的getMinutes方法返回分钟
        var ss = today.getSeconds();//通过日期对象的getSeconds方法返回秒
        // 如果分钟或小时的值小于10，则在其值前加0，比如如果时间是下午3点20分9秒的话，则显示15：20：09
        hh = checkTime(hh);
        MM = checkTime(MM);
        dd = checkTime(dd);
        mm = checkTime(mm);
        ss = checkTime(ss);
        var day; //用于保存星期（getDay()方法得到星期编号）
        if (today.getDay() == 0)   day = "星期日 ";
        if (today.getDay() == 1)   day = "星期一 ";
        if (today.getDay() == 2)   day = "星期二 ";
        if (today.getDay() == 3)   day = "星期三 ";
        if (today.getDay() == 4)   day = "星期四 ";
        if (today.getDay() == 5)   day = "星期五 ";
        if (today.getDay() == 6)   day = "星期六 ";
        document.getElementById('time').innerHTML = hh + ":" + mm + ":" + ss + "  " + yyyy + "-" + MM + "-" + dd + " " + day;
    }

    function checkTime(i) {
        if (i < 10) {
            i = "0" + i;
        }
        return i;
    }

    setInterval(startTime, 1000);//每一秒中重新加载startTime()方法

    function myMoment(value, formatString) {
        formatString = formatString || 'YYYY-MM-DD HH:mm';
        var time = new Date(parseInt(value) * 1000).format('yyyy年M月d日 hh:mm');
        return time;
    }

    $('.logout').on('click', function () {
        $.get('/UserAdmin/dologout', {}, function (res) {
            if (res.error_code == 0) {
                window.location.href = '/UserAdmin/login';
            } else {
                popWarn(res.msg);
            }
        });
    });

    $('#clearCache').on('click', function () {
        $.get('/Index/clearcache', function (res) {
            if (res.error_code == 0) {
                popWarn('清空缓存成功');
            } else {
                popWarn('清空缓存失败');
            }
        });
    });

    $('.contact').on('click', function () {
        popWarn('请联系管理员：Jeremy <br/><br/> 联系方式：18508437068');
    });

    Array.prototype.remove = function (val) {
        var index = this.indexOf(val);
        if (index > -1) {
            this.splice(index, 1);
        }
    };

    /**
     * 对Date的扩展，将 Date 转化为指定格式的String
     * 月(M)、日(d)、小时(h)、分(m)、秒(s)、季度(q) 可以用 1-2 个占位符，
     * 年(y)可以用 1-4 个占位符，毫秒(S)只能用 1 个占位符(是 1-3 位的数字)
     * 例子：
     * (new Date()).Format("yyyy-MM-dd hh:mm:ss.S") ==> 2006-07-02 08:09:04.423
     * (new Date()).Format("yyyy-M-d h:m:s.S")      ==> 2006-7-2 8:9:4.18
     * @param fmt string
     * @return string
     * */
    Date.prototype.format = function (fmt) { //author: meizz
        var o = {
            "M+": this.getMonth() + 1, //月份
            "d+": this.getDate(), //日
            "h+": this.getHours(), //小时
            "m+": this.getMinutes(), //分
            "s+": this.getSeconds(), //秒
            "q+": Math.floor((this.getMonth() + 3) / 3), //季度
            "S": this.getMilliseconds() //毫秒
        };
        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in o)
            if (new RegExp("(" + k + ")").test(fmt))
                fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
        return fmt;
    };

    /**参数说明：
     * 根据长度截取先使用字符串，超长部分追加…
     * str 对象字符串
     * len 目标字节长度
     * 返回值： 处理结果字符串
     */
    function cutString(str, len) {
        //length属性读出来的汉字长度为1
        if (str.length * 2 <= len) {
            return str;
        }
        var strlen = 0;
        var s = "";
        for (var i = 0; i < str.length; i++) {
            s = s + str.charAt(i);
            if (str.charCodeAt(i) > 128) {
                strlen = strlen + 2;
                if (strlen >= len) {
                    return s.substring(0, s.length - 1) + "...";
                }
            } else {
                strlen = strlen + 1;
                if (strlen >= len) {
                    return s.substring(0, s.length - 2) + "...";
                }
            }
        }
        return s;
    }

    // 获得用户名称
    var vm3 = new Vue({
        el: '#user_big',
        data: {
            user: '',
            logo: '',
            user_id: ''
        },
        methods: {
            getUser: function () {
                $.post('/UserAdmin/getUserName', {}, function (res) {
                    if (res.error_code == 0) {
                        vm3.user = res.username;
                        vm3.logo = res.logo;
                        vm3.user_id = res.user_id;
                    }
                });
            }
        }
    });
    vm3.getUser();

    var vm4 = new Vue({
        el: '#user_small',
        data: {
            user: '',
            logo: '',
            user_id: ''
        },
        mounted: function () {
            $('.logout').on('click', function () {
                $.get('/UserAdmin/dologout', {}, function (res) {
                    if (res.error_code == 0) {
                        window.location.href = '/UserAdmin/login';
                    } else {
                        popWarn(res.msg);
                    }
                });
            });
        },
        methods: {
            getUser: function () {
                $.post('/UserAdmin/getUserName', {}, function (res) {
                    if (res.error_code == 0) {
                        vm4.user = res.username;
                        vm4.logo = res.logo;
                        vm4.user_id = res.user_id;
                    }
                });
            }
        }
    });
    vm4.getUser();
</script>
<script>
    $('#visual-analysis-dashborad').addClass('active');

    //Flot Chart (Total Sales)
    var d1 = [];
    for (var i = 0; i <= 10; i += 1) {
        //d1.push([i, parseInt(Math.random() * 30)]);
        d1 = [[0, 700], [1, 1200], [2, 1100], [3, 900], [4, 500], [5, 700], [6, 500], [7, 600], [8, 1200], [9, 1700], [10, 1200]];
    }

    function plotWithOptions() {
        $.plot("#placeholder", [d1], {
            series: {
                lines: {
                    show: true,
                    fill: true,
                    fillColor: '#eee',
                    steps: false,

                },
                points: {
                    show: true,
                    fill: false
                }
            },

            grid: {
                color: '#fff',
                hoverable: true,
                autoHighlight: true,
            },
            colors: ['#bbb'],
        });
    }

    $("<div id='tooltip'></div>").css({
        position: "absolute",
        display: "none",
        border: "1px solid #222",
        padding: "4px",
        color: "#fff",
        "border-radius": "4px",
        "background-color": "rgb(0,0,0)",
        opacity: 0.90
    }).appendTo("body");

    $("#placeholder").bind("plothover", function (event, pos, item) {

        var str = "(" + pos.x.toFixed(2) + ", " + pos.y.toFixed(2) + ")";
        $("#hoverdata").text(str);

        if (item) {
            var x = item.datapoint[0],
                    y = item.datapoint[1];

            $("#tooltip").html("Total Sales : " + y)
                    .css({top: item.pageY + 5, left: item.pageX + 5})
                    .fadeIn(200);
        } else {
            $("#tooltip").hide();
        }
    });
</script>
<script src="/public/js/simplify/simplify_dashboard.js"></script>